<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sustainability Profile</title>
    <link rel="stylesheet" href="./../src/output.css">
</head>
<script>
    // Dropdown menüyü açma ve kapama işlevi
    function toggleDropdown() {
        const dropdown = document.getElementById("profileDropdown");
        dropdown.classList.toggle("hidden");
    }

    // Dropdown menüsünü kapatma
    function closeDropdown(event) {
        const dropdown = document.getElementById("profileDropdown");
        const button = document.getElementById("profileButton");

        // Eğer dropdown menü veya butona tıklanmadıysa, menüyü kapat
        if (!dropdown.contains(event.target) && !button.contains(event.target)) {
            dropdown.classList.add("hidden");
        }
    }

    // Sayfanın herhangi bir yerine tıklanıldığında closeDropdown fonksiyonunu çalıştır
    document.addEventListener('click', closeDropdown);

    function loadContent(content) {
        const contentArea = document.getElementById("profileContent");
        document.getElementById("profileContent").remove(" hidden");
        switch(content) {
            case 'sustainability':
                contentArea.innerHTML = '<h2>Sustainability Values</h2><p>Your sustainability data and form will go here.</p>';
                break;
 
            case 'logout':
                contentArea.innerHTML = '<h2>Logout</h2><p>You are logged out.</p>';
                // Burada çıkış işlemi yapılabilir
                break;
            default:
                contentArea.innerHTML = '<h2>Welcome to your profile!</h2>';
        }
    }
</script>
<body class="bg-white ">
    <header class="w-full h-1/6 p-3 space-x-36 top-0 left-0 z-50 flex mt-0 items-start bg-white mb-5">
        <div class="w-1/2 space-x-8 flex items-start">
        <a href="/home"class="font-rockSalt  tracking-normal text-[#52ba31]  text-2xl font-extrabold pl-2">LetterTo2050</a>
        <a href="./../src/index.html" class="text-[#52ba31] text-lg  underline underline-offset-4 hover:text-gray-300">
            <i class="fas fa-pen"></i>
            <span>Write to future</span>
        </a>
        <a href="/home" class="text-[#52ba31] text-lg  underline underline-offset-4 hover:text-gray-300">
            <i class="fas fa-book-open"></i>
            <span>Read Public Letters</span>
        </a>
    
    
    </div>
        <div class=" w-3/5 flex space-x-6 justify-end items-start pr-3">
            <a href="./../View/HomePage.html" class="text-[#52ba31] hover:text-gray-300">Home</a>
            <a href="/about" class="text-[#52ba31] hover:text-gray-300">About</a>
            <a href="./../View/quiz.html" class="text-[#52ba31] hover:text-gray-300">Quiz</a>
            
        <!-- Eğer kullanıcı giriş yapmışsa, Login butonu yerine email adresini göster -->
    
            <!-- Profilim Butonu -->
            <div class="relative inline-block text-left ">
                <button id="profileButton" onclick="toggleDropdown()" class="h-full bg-orange-500 bg text-white text-center pb-2 pt-1 px-3 rounded-lg">
                 Your Profile
                </button>
    
                <!-- Dropdown Menüsü -->
                <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white shadow-lg rounded-lg py-2">
                    <a href="./../View/sustainability.html" onclick="loadContent('sustainability')" class="block px-4 py-1 text-gray-700 hover:bg-gray-300">Sustainability Values</a>
                    <a href="./HomePage.html" onclick="loadContent('logout')" class="block px-4 py-2 text-gray-700 hover:bg-gray-300">Logout</a>
                </div>
            </div>
    

            <div id="profileContent" class="mt-6 hidden">
                
            </div>
        </div>
    
          </div>
    </header>
    
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-rockSalt font-extrabold">Sustainability Profile</h1>

        <div class=" grid grid-cols-3 gap-4 mt-4 ">
            <div class=" w-4/5 bg-orange-500  p-4 rounded-lg shadow-2xl shadow-black">
                <h2 class="text-xl text-amber-50">  World Average Recycled Waste Amount</h2>
                <p class="text-amber-50 font-bold">12 kg/month</p>
            </div>
            <div class=" w-4/5  bg-orange-500  p-4 rounded-lg shadow-2xl shadow-black">
                <h2 class="text-xl text-amber-50">World Average Fuel Consumption</h2>
                <p class="text-amber-50 font-bold">65 liter/month</p>
            </div>
            <div class=" w-4/5 bg-orange-500  p-4 rounded-lg shadow-2xl shadow-black">
                <h2 class="text-xl text-amber-50">World Average Electricity Consumption</h2>
                <p  class="text-amber-50 font-bold">250 kwh/month</p>
            </div>
            <div class="  w-4/5  bg-orange-500  p-4 rounded-lg shadow-2xl shadow-black">
                <h2 class="text-xl text-amber-50">World Average Shower Time</h2>
                <p class="text-amber-50 font-bold">300 minutes/month </p>
            </div>
            <div class="w-4/5 bg-orange-500 p-4 rounded-lg shadow-2xl shadow-black">
                <h2 class="text-xl text-amber-50">World Average Meat Consumption Frequency </h2>
                <p  class="text-amber-50 font-bold">16 days/month</p>
            </div>
            <div class="w-4/5 bg-orange-500 p-4 rounded-lg shadow-2xl shadow-black">
                <h2 class="text-xl text-amber-50">World Average Clothes Purchasing Frequency  </h2>
                <p  class="text-amber-50 font-bold">Once every 3 months</p>
            </div>
            
        </div>

        <form id="sustainability-form" class="mt-8  grid grid-cols-3">
            <div class=" w-4/5 mb-4 ml-4">
                <label for="RecycledWaste" class="  text-xl block">Recycled Waste Amount ( kg/month):</label>
                <input type="number" id="RecycledWaste" class=" border-2 w-full p-2 border-black rounded hover:border-black" placeholder=" 10" required />
            </div>
            <div class="w-4/5 mb-4 ml-4">
                <label for="FuelConsumption" class=" text-xl block">Fuel Consumption (liter/month):</label>
                <input type="number" id="FuelConsumption" class="  border-black border-2 hover:border-black w-full p-2 rounded"  placeholder="80" required />
            </div>
            <div class="w-4/5   mb-4 ml-4">
                <label for="ElectricityConsumption" class=" text-xl block">Electricity Consumption (kwh/month):</label>
                <input type="number" id="ElectricityConsumption" class="w-full border-black border-2 p-2  rounded" placeholder="300" required />
            </div>
            <div class="w-4/5   mb-4 ml-4">
                <label for="ShowerTime" class=" text-xl block">Shower Time (minutes/month):</label>
                <input type="number" id="ShowerTime" class="w-full p-2 border-black border-2 rounded"  placeholder="10" required />
            </div>
            <div class="w-4/5   mb-4 ml-4">
                <label for="MeatConsumption" class=" text-xl block">Meat Consumption Frequency (days/month):</label>
                <input type="number" id="MeatConsumption" class=" border-black border-2 w-full p-2 rounded" placeholder="20" required />
            </div>
            <div class="w-4/5   mb-4 ml-4">
                <label for="ClothesPurchasing" class=" text-xl block">Clothes Purchasing Frequency (month):</label>
                <input type="number" id="ClothesPurchasing" class="w-full p-2 border-black border-2 rounded"placeholder="5"  required />
                </div>
            </div>
        <div class="w-3/5 h-1/3 ml-8">
            <button type="submit" class="ursor bg-gradient-to-r from-orange-500 to-yellow-400 hover:from-yellow-300 hover:to-orange-500 transition-all duration-300  text-white p-2 rounded">Submit Data</button>
        </div>
        </form>

        <div id="user-data" class="mt-8">
            <h2 class="text-xl font-bold ml-8">Your Sustainability Data</h2>
            <div id="data-cards" class=" shadow-lg grid grid-cols-1 gap-4 mt-4"></div>
        </div>
    </div>

    <script>

        document.addEventListener('DOMContentLoaded', () => {
            fetchSustainabilityData();
        });
        

        document.getElementById('sustainability-form').addEventListener('submit', async (e) => {
            e.preventDefault(); 
        
       
            const data = {
                RecycledWaste: document.getElementById('RecycledWaste').value,
                FuelConsumption: document.getElementById('FuelConsumption').value,
                ElectricityConsumption: document.getElementById('ElectricityConsumption').value,
                ShowerTime: document.getElementById('ShowerTime').value,
                MeatConsumption: document.getElementById('MeatConsumption').value,
                ClothesPurchasing: document.getElementById('ClothesPurchasing').value,
                date: new Date().toLocaleString() // Giriş tarihi
            };
        
            try {
           
                const response = await fetch('http://127.0.0.1:3000/api/v1/save-sustainability-data', {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });
        
                if (!response.ok) {
                    throw new Error('Veri kaydedilemedi!');
                }
        
                alert('Veriler başarıyla kaydedildi!');
              
                fetchSustainabilityData();
            } catch (error) {
                console.error('Hata:', error);
                alert('Bir hata oluştu.');
            }
        });
        
      
        async function fetchSustainabilityData() {
    try {
        const response = await fetch('http://127.0.0.1:3000/api/v1/get-sustainability-data', {
            method: 'GET',
            credentials: 'include', 
        });

        if (!response.ok) {
            throw new Error('Veri alınamadı!');
        }

        const result = await response.json();
   
        const dataArray = result.data || result;

        const dataContainer = document.getElementById('data-cards');
        dataContainer.innerHTML = ''; 

        dataArray.forEach((item) => {
            const card = document.createElement('div');
            card.classList.add('bg-orange-500', 'p-4', 'rounded-lg', 'shadow','w-1/4','ml-8','mb-2');
            card.innerHTML = `
                <p>Recycle Waste: ${item.RecycledWaste} kg</p>
                <p>Fuel Consumption: ${item.FuelConsumption} liter</p>
                <p>Electricity Consumption: ${item.ElectricityConsumption} kwh</p>
                <p>Shower Time: ${item.ShowerTime}</p>
                <p>Meat Consumption: ${item.MeatConsumption}</p>
                <p>Clothes Purchasing: ${item.ClothesPurchasing} </p>
                <p>Created At: ${new Date(item.createdAt).toLocaleDateString()}</p>
            `;
            dataContainer.appendChild(card);
        });
    } catch (error) {
        console.error('Hata:', error);
        alert('Veriler alınırken bir hata oluştu.');
    }
}

function loadContent(page) {
    if (page === 'logout') {
        fetch('http://127.0.0.1:3000/api/v1/logout', {
            method: 'POST',
            credentials: 'include'
        })
        .then(response => {
            if (response.redirected) {
                window.location.href = response.url;
            } else {
                alert("Çıkış yapıldı, yönlendiriliyorsunuz.");
                window.location.href = './HomePage.html';
            }
        })
        .catch(error => {
            console.error('Çıkış hatası:', error);
            alert('Çıkış yapılırken bir hata oluştu.');
        });
    }
}
  
    function toggleDropdown() {
        const dropdown = document.getElementById('profileDropdown');
        dropdown.classList.toggle('hidden');
    }


    async function logoutUser() {
        try {
            const response = await fetch('http://localhost:3000/api/v1/logout', {
                method: 'GET',
                credentials: 'include',
            });

            if (response.ok) {
                alert('Çıkış başarılı! Giriş sayfasına yönlendiriliyorsunuz.');
                window.location.href = './HomePage.html'
                alert('Çıkış yapılamadı!');
            }
        } catch (err) {
            console.error('Logout hatası:', err);
            alert('Bir hata oluştu.');
        }
    }
        </script>
        
</body>
</html>
